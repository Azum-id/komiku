<!doctype html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Scraper Manga Komiku</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        />
        <style>
            body {
                background-color: #121212;
                color: white;
            }
            .container {
                max-width: 900px;
                margin-top: 50px;
            }
            .card {
                background-color: #1f1f1f;
                border: 1px solid #333;
                border-radius: 8px;
                color: white;
            }
            .card-body h5 {
                font-size: 18px;
                font-weight: bold;
                color: white;
            }
            .card-body p {
                font-size: 14px;
                color: #ccc;
            }
            .card img {
                height: 100%;
                object-fit: cover;
            }
            .btn-custom {
                background-color: #333;
                border: none;
                color: white;
                font-size: 14px;
                border-radius: 4px;
                transition: 0.3s;
                width: 48%;
            }
            .btn-custom:hover {
                background-color: #555;
            }
            .btn-container {
                display: flex;
                justify-content: space-between;
                gap: 10px;
                margin-top: 10px;
            }
            #searchResults {
                margin-top: 20px;
                max-height: 500px;
                overflow-y: auto;
                display: none; /* Sembunyikan sementara */
            }
            .separator {
                margin-top: 20px;
                border-top: 1px solid #333;
                display: none; /* Sembunyikan separator sampai ada hasil */
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1 class="text-center mb-5 fw-bold">Scraper Manga Komiku</h1>
            <div class="row g-4">
                <!-- Card 1: Masukkan URL -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header text-center">
                            <h4>Masukkan URL Chapter</h4>
                        </div>
                        <div class="card-body">
                            <form method="GET" action="/read">
                                <div class="mb-3">
                                    <input
                                        type="text"
                                        name="url"
                                        class="form-control form-control-lg text-center"
                                        placeholder="Masukkan URL..."
                                        required
                                    />
                                </div>

                                <!-- Tombol Ambil Manga (Go) -->
                                <button
                                    type="submit"
                                    class="btn btn-custom w-100"
                                >
                                    <i class="fa fa-arrow-right"></i> Ambil
                                    Manga
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Cari Manga -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header text-center">
                            <h4>Cari Manga</h4>
                        </div>
                        <div class="card-body">
                            <form id="searchForm">
                                <div class="mb-3">
                                    <input
                                        type="text"
                                        id="searchInput"
                                        class="form-control form-control-lg text-center"
                                        placeholder="Cari Manga..."
                                        required
                                    />
                                </div>
                                <!-- Tombol Cari (Search) -->
                                <button
                                    type="submit"
                                    class="btn btn-custom w-100"
                                >
                                    <i class="fa fa-search"></i> Cari
                                </button>
                            </form>
                            <div id="searchResults" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Garis Pemisah yang akan muncul saat ada hasil pencarian -->
            <hr class="separator" />
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function () {
                $("#searchForm").on("submit", function (e) {
                    e.preventDefault(); // Mencegah submit form default
                    const query = $("#searchInput").val().trim();
                    const searchResults = $("#searchResults");
                    const separator = $(".separator");

                    searchResults.empty(); // Hapus konten lama
                    searchResults.hide(); // Sembunyikan sementara
                    separator.hide(); // Sembunyikan separator

                    if (query.length > 0) {
                        $.ajax({
                            url: `/search?query=${encodeURIComponent(query)}`,
                            method: "GET",
                            success: function (data) {
                                if (data.results && data.results.length > 0) {
                                    data.results.forEach(item => {
                                        const resultItem = `
                                        <div class="card mb-3" style="max-width: 540px;">
                                            <div class="row g-0">
                                                <div class="col-md-4">
                                                    <img src="${
                                                        item.coverImage
                                                    }" class="img-fluid rounded-start" alt="${
                                                        item.title
                                                    }">
                                                </div>
                                                <div class="col-md-8">
                                                    <div class="card-body">
                                                        <h5 class="card-title">${
                                                            item.title
                                                        }</h5>
                                                        <p class="card-text">${
                                                            item.description
                                                        }</p>
                                                        <div class="btn-container">
                                                            <button class="btn btn-custom" onclick="window.location.href='/read?url=${encodeURIComponent(
                                                                item
                                                                    .startChapter
                                                                    .url
                                                            )}'">
                                                                <i class="fa fa-book"></i> Chapter 1
                                                            </button>
                                                            <button class="btn btn-custom" onclick="window.location.href='/read?url=${encodeURIComponent(
                                                                item
                                                                    .latestChapter
                                                                    .url
                                                            )}'">
                                                                <i class="fa fa-arrow-up"></i> Chapter ${item.latestChapter.text.match(/\d+/)[0]}
                                                            </button>
                                                        </div>
                                                        <!-- Tombol 'List Chapter' -->
                                                        <button class="btn btn-custom w-100 mt-2" onclick="window.location.href='/details?url=${encodeURIComponent(
                                                            item.mangaUrl
                                                        )}'">
                                                            <i class="fa fa-list"></i> List Chapter
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                        searchResults.append(resultItem);
                                    });
                                    searchResults.show(); // Tampilkan hasil
                                    separator.show(); // Tampilkan separator
                                } else {
                                    searchResults.html(
                                        "<p class='text-center'>Tidak ada hasil ditemukan.</p>"
                                    );
                                    searchResults.show(); // Tampilkan pesan
                                    separator.show(); // Tampilkan separator
                                }
                            },
                            error: function () {
                                searchResults.html(
                                    "<p class='text-center text-danger'>Gagal memuat hasil pencarian.</p>"
                                );
                                searchResults.show(); // Tampilkan pesan error
                                separator.show(); // Tampilkan separator
                            }
                        });
                    }
                });
            });
        </script>
    </body>
</html>
